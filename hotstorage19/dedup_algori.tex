\paragraph{User-based cache algorithm}
%\label{sec:design_cache_algori}

\input{cache_algori.tex}

We leverage observations from our study of the user access patterns to guide our cache replacement. This is because
a user's active time is more predictable as discussed in~\cref{sec:background}.
%   In~\cref{sec:design}, the incoming \texttt{push} layer requests are first buffered in the layer buffer and later evicted to the file cache.
%   If there is a \texttt{pull} layer request miss in both the layer buffer and the file cache, 
%   \sysname~will fetch the layer from backend storage system and store it in the layer buffer.
We service requests from the layer buffer, then file cache, and then from the backend storage system. 
When a cache (layer buffer or file cache) is under pressure due to 
shortage of free space,
the layer buffer or the file cache will simply evict or delete some layers or files and reclaim space.
Since our layer buffer and file cache both share the same cache replacement algorithm, we only present
our user-based cache replacement algorithm for the layer buffer as shown in Algorithm~\ref{alg:cache}.

Free space in the layer buffer is considered too low if ($free\_buffer$ $<$ $S_{thresh}$). 
In such a sitation, \sysname~will free the buffer space used by inactive users. 
\sysname~maintains two LRU lists: an LRU list of active users, and
an LRU list of recently accessed layers, referred to as \emph{UsrLRU} and \emph{LayerLRU}, respectively.
At first, \sysname~will select the least active user from \emph{UsrLRU}.
Next, \sysname~will \arb{what is???: reversely iterate} \emph{UsrLRU} until it finds a layer that is exclusively owned by that least active user. 
\sysname~then evicts this layer from the layer buffer. 
 Note that layers are shared among different active users.
 \sysname~will continue to evict until the free space in the layer buffer is above the specified capacity threshold.
 
%iteratively removes the least active users along with the least recently accessed layers 
% that exclusively owned by these users from the two LRU lists and evict the layers from layer buffer.
%, then   


