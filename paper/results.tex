
\section{Results}

\subsection{Image}

\subsubsection{Growth of images in Docker hub}

Figure~\ref{fig_image_growth} show the total number of images in Docker hub increases from May 30th to Sept. 20th 2017. As discussed in~\cite{XXX}, Crawler searched for `/' by using Docker hub search engine, crawled the web page, and obtained the total number of non-official public repositories in Docker hub each day. By summing both official repository count and non-official repository count, we got the total number of repositories in Docker hub each day. As shown, the total number of repositories increased from 633,915 on May 30th to 687,292 on Jul. 11th with ~1,241 repositories created per day.

\begin{figure}
  \centering
  % Requires \usepackage{graphicx}
  \includegraphics[width=0.5\textwidth]{graphs/image_growth.pdf}
  \caption{Total number of repositories in Docker hub from May 30th to Sept. 20th}\label{fig_image_growth}
\end{figure}

A interesting observation is that Crawler can get a similar list of images if we replace `/' with `*'. Note that from 5/30/2017-7/11/2017, Crawler used above method to obtain the total amount of images in Docker Hub. But after 7/11/2017, the Docker Hub removed the index of `/'. Thus, currently we search for `*' instead of `/' to obtain a list of non-official public images. As shown in figure~\ref{fig_image_growth}, the total number of repositories increased from 708,647 on Jul. 26 to 784,182 on Sept. 20, with ~1,325 new repositories created per day. Overall, the total number of repositories is increasing, although there are two troughs during the period of 08/06-08/07 and 08/13-08/15.

\subsubsection{Image popularity distribution}

Figure~\ref{fig-pop} shows the repository popularity distribution by May 31th. The x-axies show the pull count (i.e., total number of pulls) for repositories by May 31th with different ranges.
Figure~\ref{fig_pull_cnt_total} shows the cumulative repository frequency by pull count. ~95\% of the repositories are pulled than 1000 totally. 90\% of the repositories only have a pull count less than 333. The greatest pull count is 654,088,410, which is official repository~\textit{nginx}. 
Figure~\ref{fig_pull_cnt_count} shows the repository frequency by pull count. 31,200 of repositories are not at all.  
34,100 repositories are pulled only ~4 times and 27,600 repositories are pulled ~37 times, which are the two peaks shown in the figure.
Overall, repository frequency decreases with the pull count.

The skewness of two curves in figure~\ref{fig-pop} suggests that Docker hub is a good fit for caching few popular repositories or images, which can significantly improve the \textit{pull} or \textit{push} performance.      

\begin{figure}[!t]
	\centering
	\subfigure[CDF of repositories by pull count]{\label{fig_pull_cnt_total}
		\includegraphics[width=0.22\textwidth]{graphs/pull_cnt.pdf}
	}
	\subfigure[Histogram of repositories by pull count]{\label{fig_pull_cnt_count}
		\includegraphics[width=0.22\textwidth]{graphs/count_pull_cnt.pdf}
	}
	\caption{Repository popularity distribution}
	\label{fig-pop}
\end{figure}


\subsubsection{Image size distribution}
\label{sec:image-size}
We measured three kinds of image size: archival size, compression size, and the sum of containing file size. Compression size is the sum of its containing \textit{gzip} compressed layer size (i.e., original layer size after downloaded); The archival size is the sum of its containing decompressed layer size (i.e., decompressed layer size without extracting and unpacking); The sum of containing file size is the sum of its containing file size after decompression with extracting and unpacking.

Figure~\ref{fig-image-size} shows the cumulative image frequency by two scales (GB and MB) for three kinds of image size.
As shown in figure~\ref{fig_image_size_gb}, the red curve and blue curve are almost overlapped, which means that the distribution of archival size and the distribution of sum of file size are similar. 90\% of images have a less than 1.3GB uncompression size (i.e., archival size or the sum of containing file size), while 90\% of images have a less than 0.48 GB compression size. The largest uncompression image size is ~498 GB while the largest compression size is only 202 GB.
Figure~\ref{fig_image_size_mb} shows the cumulative image frequency by MBs. 70\% of the images have a less than 190 MB compression size. And 70\% of the images have a less than 478 MB uncompression size (i.e., archival size or the sum of containing file size). Half of the images have a less than ~17 MB compression size. Half of the images have a less than 46 MB archival size and 94 MB sum of containing file size.

Figure~\ref{fig-image-size} shows that the majority of the images in Docker hub have a smaller size. 90\% of images can be compressed with less than 500 MB and 70\% of images are less than 500 MB even without compression. 

\begin{figure}[!t]
	\centering
	\subfigure[CDF of images by size (GB)]{\label{fig_image_size_gb}
		\includegraphics[width=0.22\textwidth]{graphs/image_size.pdf}
	}
	\subfigure[CDF of images by size (MB)]{\label{fig_image_size_mb}
		\includegraphics[width=0.22\textwidth]{graphs/image_size_mb.pdf}
	}
	\caption{Image size distribution}
	\label{fig-image-size}
\end{figure}

\subsubsection{Compression rate distribution}

\begin{figure}[!t]
	\centering
	\subfigure[CDF of images by compression ratio]{\label{fig_image_compression_ratio}
		\includegraphics[width=0.22\textwidth]{graphs/image_compression_ratio_less.pdf}
	}
	\subfigure[Histogram of images by compression ratio]{\label{fig_image_compression_ratio_less}
		\includegraphics[width=0.23\textwidth]{graphs/hist_compression_ratio.pdf}
	}
	\caption{Compression rate distribution}
	\label{fig-image-compression-ratio}
\end{figure}

As discussed in~\ref{sec:image-size}, three kinds of image size are measured: archival size, compression size, and the sum of containing file size. Thus, we calculated two kinds of compression ratio: the ratio of archival size to compression size and the ratio of Sum of file size to compression size. 

Figure~\ref{fig-image-compression-ratio} shows the cumulative image frequency by compression ratio. Overall, we can see that the ratio of archival size to compression size is greater than the ratio of the sum of file size to the compression size. 90\% of images have a archival-to-compression ratio less than ~4 while 90\% of images have a sum of file-to-compression ratio less than 35. Half of the images have a compression ratio (both archival-to-compression and sum of files-to-compression) around 3. The maximum compression ratio are 512,930 and 1028 for the ratio of sum to file size to compression size and the ratio of archival to compression size respectively.
Figure~\ref{fig_image_compression_ratio_less} shows a histogram of image frequency by compression ratio. 134,000 images have a ratio of sum of file size to compression size of 3.5 and 90,000 images have a ratio of sum of archival size to compression size of 2.5, which are two peaks shown in the graph.

Figure~\ref{fig-image-compression-ratio} suggests that Docker images has a great potential for compression to save space.

\subsubsection{Layer count distribution}

\begin{figure}[!t]
	\centering
	\subfigure[CDF of images by layer count]{\label{fig_layer_cnt_less}
		\includegraphics[width=0.23\textwidth]{graphs/layer_cnt_less.pdf}
	}
	\subfigure[Histogram of images by Layer count in images]{\label{fig_hist_layer_cnt}
		\includegraphics[width=0.22\textwidth]{graphs/hist_layer_cnt.pdf}
	}
	\caption{Compression rate distribution}
	\label{fig-layer-cnt}
\end{figure}

As discussed in~\ref{sec-image-layers}, images are consisted of a set of layers. Figure~\ref{fig-layer-cnt} shows the cumulative image frequency by layer count in images. 90\% of images have less than 18 layers. Half of images have less than 8 layers. 

Figure~\ref{fig_hist_layer_cnt} shows the histogram of images by layer count in images. About 51,300 images have 8 layers, which is the peak value in the figure. The maximum layer count is 121. The average is 10. 7,060 images have only 1 layer. 

%\begin{figure}
%	\centering
%	\begin{minipage}{0.25\textwidth}
%		\centering
%		\includegraphics[width=1\textwidth]{graphs/layer_cnt_less.pdf}
%		\caption{CDF of images by layer count}
%		\label{fig-layer-cnt1}
%	\end{minipage}%
%	\begin{minipage}{0.25\textwidth}
%		\centering
%		\includegraphics[width=1\textwidth]{graphs/repeate_layer.pdf}
%		\caption{CDF of layers by repeat layer count}
%		\label{fig-repeat-layer-cnt}
%	\end{minipage}
%\end{figure}

\begin{figure}[!t]
	\centering
	\subfigure[CDF of layer by layer count]{\label{fig_repeate_layer}
		\includegraphics[width=0.22\textwidth]{graphs/repeate_layer.pdf}
	}
	\subfigure[Histogram of images by Layer count in images]{\label{fig_hist_repeate_layer}
		\includegraphics[width=0.23\textwidth]{graphs/hist_repeate_layer.pdf}
	}
	\caption{Compression rate distribution}
	\label{fig-repeat-layer-cnt}
\end{figure}

\subsubsection{Repeat layer count distribution}

As discussed in~\ref{sec-image-layers}, layers are shared among images. Figure~\ref{fig_repeate_layer} shows the cumulative layer frequency by repeat count among images. Around 90\% of layers are only reference by a single image. 99\% of layers are shared among less than 25 images. 

Figure~\ref{fig_hist_repeate_layer} shows the histogram of layers by repeat count among images. About 1,440,000 layers are referenced by only one single image, which is the peak value in the figure. The maximum repeat count is 33,428 while the median is 1. The average is 2.

\subsubsection{Directory count distribution}

\begin{figure}
	\centering
	\begin{minipage}{0.26\textwidth}
		\centering
		\includegraphics[width=1\textwidth]{graphs/dir.pdf}
		\caption{CDF of images by directories}
		\label{fig-dir}
	\end{minipage}%
	\begin{minipage}{0.24\textwidth}
		\centering
		\includegraphics[width=1\textwidth]{graphs/file.pdf}
		\caption{CDF of images by files}
		\label{fig-file}
	\end{minipage}
\end{figure}

Figure~\ref{fig-dir} shows the cumulative image frequency by directories. 90\% of images have less than 7,344 directories. Half of images have less than 296 directories. The maximum is 1,168,160 while the minimum is 1. The average is 2705. 
%\begin{figure}
%	\centering
%	% Requires \usepackage{graphicx}
%	\includegraphics[width=0.5\textwidth]{graphs/File_count_for_each_image.png}\\
%	\caption{File count distribution}\label{fig_image_size_compression}
%\end{figure}

\subsubsection{File count distribution}

Figure~\ref{fig-file} shows the cumulative image frequency by files. 90\% of images have less than 64,780 directories. Half of images have less than 1,090 files. The maximum is 8,509,958 while the minimum is 1. The average is 21,413. 

\subsection{Layer}

\subsubsection{Layer size distribution}

1. Fig: Layer compression size

\begin{figure}
	\centering
	% Requires \usepackage{graphicx}
	\includegraphics[width=0.5\textwidth]{graphs/Compressed_layer_tarball_size_(MB).png}\\
	\caption{Layer compression size}\label{fig_image_size_compression}
\end{figure}

2. Fig: Layer Decompressed size

\begin{figure}
	\centering
	% Requires \usepackage{graphicx}
	\includegraphics[width=0.5\textwidth]{graphs/Uncompressed_layer_size_(MB)_as_sum_of_files.png}\\
	\caption{Layer decompression size (sum of file)}\label{fig_image_size_compression}
\end{figure}

\begin{figure}
	\centering
	% Requires \usepackage{graphicx}
	\includegraphics[width=0.5\textwidth]{graphs/Uncompressed_layer_tarball_size_(MB).png}\\
	\caption{Layer decompression size (archival)}\label{fig_image_size_compression}
\end{figure}

\subsubsection{Compression rate distribution}

1. Fig: Compression ration as the layer decompression size divided by the gzip compressed layer size.

\begin{figure}
	\centering
	% Requires \usepackage{graphicx}
	\includegraphics[width=0.5\textwidth]{graphs/Compression_ratio_Uncompressed_layer_size_as_sum_of_files_divided_by_compressed_size_with_method_gzip.png}\\
	\caption{Compression rate}\label{fig_image_size_compression}
\end{figure}

\begin{figure}
	\centering
	% Requires \usepackage{graphicx}
	\includegraphics[width=0.5\textwidth]{graphs/Compression_ratio_Uncompressed_layer_tarball_size_divided_by_compressed_size_with_method_gzip.png}\\
	\caption{Compression rate}\label{fig_image_size_compression}
\end{figure}

\subsubsection{Layer depth distribution}

1. Fig: Layer depth

\begin{figure}
	\centering
	% Requires \usepackage{graphicx}
	\includegraphics[width=0.5\textwidth]{graphs/Layer_directory_depth_for_each_image.png}\\
	\caption{Layer depth distribution}\label{fig_image_size_compression}
\end{figure}


\subsubsection{File count distribution}

1. Fig: File count distribution.

\subsubsection{Directory count distribution}

1. Fig: Directory count distribution.

\begin{figure}
	\centering
	% Requires \usepackage{graphicx}
	\includegraphics[width=0.5\textwidth]{graphs/Layer_directory_count_across_all_images.png}\\
	\caption{Directory count distribution}\label{fig_image_size_compression}
\end{figure}

\subsubsection{Layer directory depth distribution}

1. Fig: Layer directory depth distribution.


\subsubsection{Other metrics, layer age}

\subsection{File}

%\subsubsection{File count distribution}

\subsubsection{File size distribution}

\subsubsection{File type distribution}

REGTYPE:3006619271
SYMTYPE: 282379663

\begin{figure*}
	\centering
	% Requires \usepackage{graphicx}
	\includegraphics[width=1\textwidth]{graphs/file_type.png}\\
	\caption{file type distribution (archival)}\label{xxx}
\end{figure*}

\subsubsection{Repeat file count distribution}
